<Window x:Class="Benner.Views.PedidoView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Benner.ViewModels"
        xmlns:helpers="clr-namespace:Benner.Helpers"
        mc:Ignorable="d"
        Title="Cadastro de Pedido" Height="700" Width="900"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:PedidoViewModel/>
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
            <Label Content="Cliente:" VerticalAlignment="Center"/>
            <ComboBox Width="200" DisplayMemberPath="Nome"
                      SelectedItem="{Binding ClienteSelecionado}"
                      ItemsSource="{Binding Clientes}"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,10">
            <Label Content="Produto:" VerticalAlignment="Center"/>
            <ComboBox Width="200" DisplayMemberPath="Nome"
                      SelectedItem="{Binding ProdutoSelecionado}"
                      ItemsSource="{Binding Produtos}"/>
            <Label Content="Qtd:" VerticalAlignment="Center" Margin="10,0,0,0"/>
            <TextBox Width="50" Text="{Binding Quantidade, UpdateSourceTrigger=PropertyChanged}" Margin="5,0"/>
            <Button Content="Adicionar Produto" Width="130" Margin="10,0,0,0"
                    Command="{Binding AdicionarProdutoCommand}"/>
        </StackPanel>

        <GroupBox Header="Itens do Pedido" Grid.Row="2" Margin="0,0,0,10">
            <DataGrid ItemsSource="{Binding ItensPedido}" AutoGenerateColumns="False"
                      CanUserAddRows="False" IsReadOnly="True" SelectionMode="Single"
                      SelectionUnit="FullRow">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Produto" Binding="{Binding Produto.Nome}" Width="*"/>
                    <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="50"/>
                    <DataGridTextColumn Header="Valor Unit" Width="80"
                                        Binding="{Binding Produto.Valor, StringFormat=R$ {0:N2}}"/>
                    <DataGridTextColumn Header="Total" Width="80"
                                        Binding="{Binding Subtotal, StringFormat=R$ {0:N2}}"/>
                    <DataGridTemplateColumn Header="Ações" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Remover"
                                        Command="{Binding DataContext.RemoverProdutoCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <StackPanel Orientation="Horizontal" Grid.Row="3" Margin="0,10,0,0">
            <Label Content="Forma de Pagamento:" VerticalAlignment="Center"/>
            <ComboBox Width="120" Margin="5,0"
                ItemsSource="{Binding Source={x:Static helpers:FormaPagamentoHelper.GetValues}}"
                SelectedItem="{Binding FormaPagamentoSelecionada}"/>
            <Label Content="Valor Total:" VerticalAlignment="Center" Margin="20,0,0,0"/>
            <TextBlock Text="{Binding ValorTotal, StringFormat=C}" VerticalAlignment="Center" Width="100" Margin="5,0"/>
            <Button Content="Finalizar Pedido" Width="150" Margin="20,0,0,0"
                    Command="{Binding FinalizarPedidoCommand}"/>
        </StackPanel>

        <GroupBox Header="Pedidos Finalizados" Grid.Row="4" Margin="0,0,0,10">
            <DataGrid ItemsSource="{Binding PedidosFinalizados}" AutoGenerateColumns="False"
                      CanUserAddRows="False" IsReadOnly="True" SelectionMode="Single"
                      SelectionUnit="FullRow">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Data da Venda" Binding="{Binding DataVenda}" Width="150"/>
                    <DataGridTextColumn Header="Valor Total" Width="100" Binding="{Binding ValorTotal, StringFormat=R$ {0:N2}}"/>
                    <DataGridTextColumn Header="Forma de Pagamento" Binding="{Binding FormaPagamento}" Width="150"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                    <DataGridTemplateColumn Header="Ações" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="Pago" Command="{Binding DataContext.MarcarPagoCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" Margin="2,0"/>
                                    <Button Content="Enviado" Command="{Binding DataContext.MarcarEnviadoCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" Margin="2,0"/>
                                    <Button Content="Recebido" Command="{Binding DataContext.MarcarRecebidoCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" Margin="2,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>
    </Grid>
</Window>
